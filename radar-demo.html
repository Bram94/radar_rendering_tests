<!doctype html>
<html>
  <head>
    <title>QuadWeather Radar</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no,width=device-width' />
    <meta name="Description" content="View 3D radar for severe storms." />
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
    <link rel="stylesheet" href="css/radarstyle.css">
    <link href="https://fonts.googleapis.com/css?family=Oleo+Script&display=swap" rel="stylesheet">
  </head>
  <body>
    <canvas id="texturecolorbar" class="texturecolorbar"></canvas>
    <div id="map" class="mobilemap"></div>
    <script type="x-shader/x-vertex" id="vertexShader">
      attribute vec2 aPosition;
      varying float x, y, Re, c, cos_c, sin_c, lat, lon, lat_0, lon_0, pi, mx, my;
      attribute float aColor;
      uniform mat4 u_matrix;
      varying float color;
      
      void main() {     
        color = aColor;
        pi = radians(180.);
        
        x = aPosition.x*sin(aPosition.y*pi/180.);
        y = aPosition.x*cos(aPosition.y*pi/180.);

        Re = 6371000.;
        lat_0 = radians(35.33335);
        lon_0 = radians(-97.27776);
        x /= Re;
        y /= Re;
        c = length(vec2(x, y));
        cos_c = cos(c);
        sin_c = sin(c);

        lat = asin(cos_c*sin(lat_0)+y*sin_c*cos(lat_0)/c);
        lon = lon_0+atan(x*sin_c/(c*cos(lat_0)*cos_c-y*sin(lat_0)*sin_c));
        
        mx = 0.5 + 0.5*lon/pi;
        my = 0.5 - 0.5*log(tan(pi/4. + lat/2.))/pi;
        gl_Position = u_matrix * vec4(mx, my, 0., 1.);
      }
      
    </script>
    <script type="x-shader/x-fragment" id="fragmentShader">
      precision mediump float;
      varying float color;
      uniform sampler2D u_texture;
      void main() {
        //gl_FragColor = vec4(0.0,color/60.0,0.0,1.0);
        float calcolor = (color)/(70.0);
        gl_FragColor = texture2D(u_texture,vec2(min(max(calcolor,0.0),1.0),0.0));
        //gl_FragColor = vec4(1.0,0.0,0.0,1.0);
      }
    </script>
    <script>
    </script>
    <script type="module" src="scripts/demo-radar-script.js"></script>
  </body>  
</html>


